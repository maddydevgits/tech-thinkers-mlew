{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2" data-translate="shop_profile_title">Shop Profile</h1>
        <p class="text-gray-600" data-translate="shop_profile_desc">Update your shop information and location details</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
        <form method="POST" class="space-y-6">
            <div class="border-b border-gray-200 pb-4 mb-6">
                <h2 class="text-xl font-semibold text-gray-800" data-translate="shop_information">Shop Information</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="shop_name" class="block text-sm font-medium text-gray-700 mb-2" data-translate="shop_name">
                        Shop Name *
                    </label>
                    <input type="text" id="shop_name" name="shop_name" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                           value="{{ user.shop_name or '' }}"
                           placeholder="Enter your shop name" data-translate-placeholder="shop_name_placeholder">
                </div>

                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-2" data-translate="phone_number">
                        Phone Number *
                    </label>
                    <input type="tel" id="phone" name="phone" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                           value="{{ user.phone or '' }}"
                           placeholder="Enter phone number" data-translate-placeholder="phone_placeholder">
                </div>
            </div>

            <div>
                <label for="shop_address" class="block text-sm font-medium text-gray-700 mb-2" data-translate="shop_address">
                    Shop Address *
                </label>
                <textarea id="shop_address" name="shop_address" rows="3" required
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                          placeholder="Enter complete shop address" data-translate-placeholder="shop_address_placeholder">{{ user.shop_address or '' }}</textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="city" class="block text-sm font-medium text-gray-700 mb-2" data-translate="city">
                        City *
                    </label>
                    <input type="text" id="city" name="city" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                           value="{{ user.city or '' }}"
                           placeholder="Enter city" data-translate-placeholder="city_placeholder">
                </div>

                <div>
                    <label for="state" class="block text-sm font-medium text-gray-700 mb-2" data-translate="state">
                        State *
                    </label>
                    <input type="text" id="state" name="state" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                           value="{{ user.state or '' }}"
                           placeholder="Enter state" data-translate-placeholder="state_placeholder">
                </div>

                <div>
                    <label for="pincode" class="block text-sm font-medium text-gray-700 mb-2" data-translate="pincode">
                        Pincode *
                    </label>
                    <input type="text" id="pincode" name="pincode" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                           value="{{ user.pincode or '' }}"
                           placeholder="Enter pincode" data-translate-placeholder="pincode_placeholder">
                </div>
            </div>

            <div class="border-t border-gray-200 pt-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4" data-translate="gps_coordinates">GPS Coordinates (Optional)</h3>
                <p class="text-sm text-gray-600 mb-4" data-translate="gps_help">GPS coordinates help farmers find your shop easily. You can get these from Google Maps.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="latitude" class="block text-sm font-medium text-gray-700 mb-2" data-translate="latitude">
                            Latitude
                        </label>
                        <input type="number" id="latitude" name="latitude" step="any"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                               value="{{ user.latitude or '' }}"
                               placeholder="e.g., 12.9716" data-translate-placeholder="latitude_placeholder">
                    </div>

                    <div>
                        <label for="longitude" class="block text-sm font-medium text-gray-700 mb-2" data-translate="longitude">
                            Longitude
                        </label>
                        <input type="number" id="longitude" name="longitude" step="any"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"
                               value="{{ user.longitude or '' }}"
                               placeholder="e.g., 77.5946" data-translate-placeholder="longitude_placeholder">
                    </div>
                </div>

                <div class="mt-4">
                    <button type="button" onclick="getCurrentLocation()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium" data-translate="get_current_location">
                        <i class="fas fa-map-marker-alt mr-2"></i>Get My Location
                    </button>
                </div>
            </div>

            <div class="flex justify-end space-x-4 pt-6">
                <a href="{{ url_for('dashboard') }}" class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition duration-300" data-translate="cancel">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300" data-translate="update_profile">
                    <i class="fas fa-save mr-2"></i>Update Profile
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function getCurrentLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
                document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
                
                // Show success message
                const button = document.querySelector('button[onclick="getCurrentLocation()"]');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Location Found!';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600', 'hover:bg-green-700');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600', 'hover:bg-green-700');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
            },
            function(error) {
                alert('Unable to get your location. Please enter coordinates manually.');
                console.error('Geolocation error:', error);
            }
        );
    } else {
        alert('Geolocation is not supported by this browser. Please enter coordinates manually.');
    }
}
</script>
{% endblock %}
